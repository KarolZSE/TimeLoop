import{r as N,g as Y}from"./phaser-Czz4FBZH.js";import{initializeApp as _}from"https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";import{getFirestore as k,addDoc as H,collection as A,getDocs as R}from"https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";import{getAuth as W,signInAnonymously as $,onAuthStateChanged as q}from"https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))g(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&g(r)}).observe(document,{childList:!0,subtree:!0});function f(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function g(t){if(t.ep)return;t.ep=!0;const s=f(t);fetch(t.href,s)}})();var G=N();const x=Y(G),L={height:600,width:800};var h,n=[],i=[0],o=0,e=0,w=0,d=0,v=0,S=0;let y="",z=0,I=0,m=0;var P=0,F="Stable";const K=30;class V extends x.Scene{constructor(){super("PauseScene")}preload(){this.load.image("tile","tile.png")}create(){this.add.image(this.cameras.main.centerX-200,this.cameras.main.centerY-300,"tile").setOrigin(0,0).setScale(1.2);const a=this.add.text(this.cameras.main.centerX-130,this.cameras.main.centerY+150,"Continue...",{fontFamily:"PressStart2P",fontSize:"18px",color:"#2d4ee0ff"});m==0&&(this.Texto=this.add.text(this.cameras.main.centerX-120,this.cameras.main.centerY,"Whats your name?",{fontFamily:"PressStart2P",fontSize:"18px",color:"#000000ff"})),m==1&&this.add.text(this.cameras.main.centerX-130,this.cameras.main.centerY-200,"Congratulations! New mission awaits!",{fontFamily:"PressStart2P",fontSize:"14px",color:"#0f7929ff"}),m==2&&this.add.text(this.cameras.main.centerX-130,this.cameras.main.centerY-200,"You died! The enemy destroyed you!",{fontFamily:"PressStart2P",fontSize:"14px",color:"#c41818ff"}),m==3&&this.add.text(this.cameras.main.centerX-130,this.cameras.main.centerY-200,"You died! Time ran out!",{fontFamily:"PressStart2P",fontSize:"14px",color:"#c41818ff"}),a.setInteractive(),a.on("pointerdown",()=>{I==0&&(I=1,this.scene.launch("scene-game")),this.scene.resume("scene-game"),this.scene.stop()})}update(){this.input.keyboard.once("keydown",a=>{z==0&&(z=1,a.key==="Backspace"&&(y=y.slice(0,-1),this.Texto&&this.Texto.setText(y)),/^[a-zA-Z0-9]$/.test(a.key)&&(y+=a.key,this.Texto&&this.Texto.setText(y)))}),this.input.keyboard.once("keyup",()=>{z=0})}}class j extends x.Scene{constructor(){super("scene-game"),this.player,this.enemy,this.timedEvent,this.timedEvent2,this.remainingTime,this.remainingTime2,this.badguy,this.temporary=0,this.video,this.data3,this.Home,this.trails=null,this.evil_trails=null}preload(){this.enemy=this.load.image("enemy","enemy2.png"),this.player=this.load.image("player","spaceship.png"),this.spawnpoint=this.load.image("spawn","enemy1.png")}create(){this.TextTimer=this.add.text(this.cameras.main.centerX-200,10,"Move mouse for 10 sec. Enemy spawns at X.",{fontFamily:"PressStart2P",fontSize:"12px",color:"#000000ff"}),this.player=this.physics.add.image(400,400,"player").setOrigin(.5,.5).setScale(1.5),this.add.image(this.player.x,this.player.y,"spawn").setOrigin(.5,.5).setScale(1.5),h=this.input.activePointer,this.timedEvent=this.time.delayedCall(1e4,()=>{},[],this),this.player.setCollideWorldBounds(!0),this.playerSensor=this.physics.add.sprite(this.player.x,this.player.y,null).setOrigin(.5).setSize(16,16),this.playerSensor.visible=!1,this.badguysSensors=this.physics.add.group(),this.spawns=this.add.group(),this.trails=this.physics.add.group(),this.evil_trails=this.physics.add.group()}update(a,f){let g=x.Math.Angle.Between(this.player.x,this.player.y,h.x,h.y);if(this.lastMovementSampleTime||(this.lastMovementSampleTime=a),a-this.lastMovementSampleTime>=K&&(n.push({t:a,x:this.player.x,y:this.player.y,r:this.player.rotation}),this.lastMovementSampleTime=a),(h.x!==this.lastX||h.y!==this.lastY)&&(this.player.setRotation(g+Math.PI/2),this.physics.moveTo(this.player,h.x,h.y,400),this.physics.moveTo(this.playerSensor,h.x,h.y,400)),this.lastX=h.x,this.lastY=h.y,this.remainingTime=this.timedEvent.getRemainingSeconds(),this.remainingTime<=0){for(w==0&&(i.push(n.length),w=1,this.trailTouched=0);e<i.length;){if(i[e]+o<i[e+1]){if(this["badguy"+e]||(this["badguy"+e]=this.physics.add.image(n[i[e]+o].x,n[i[e]+o].y,"enemy").setOrigin(.5,.5).setScale(1.5),this["badguy"+e].setCollideWorldBounds(!0)),!this["badguySensor"+e]&&this["badguy"+e].visible==!0){let t=this["badguySensor"+e]=this.physics.add.sprite(this["badguy"+e].x,this["badguy"+e].y,null).setOrigin(.5).setSize(16,16);this["badguySensor"+e].visible=!1,this.badguysSensors.add(t),this["badguy"+e].setCollideWorldBounds(!0)}v==0&&(S=0,this.Home=this.add.image(this.player.x,this.player.y,"spawn").setOrigin(.5,.5).setScale(1.5),this.spawns.add(this.Home),this.timedEvent2&&this.timedEvent2.remove(),this.timedEvent2=this.time.delayedCall(n[i[i.length-1]-1].t-n[i[i.length-2]].t+2,()=>{n.length=i[1],w=1,this.trailTouched=0,o=0,v=0;for(let t=1;t<i.length;t++)this["badguySensor"+t]&&(this["badguy"+t].body.enable=!1,this["badguySensor"+t].visible=!1,this["badguySensor"+t].setCollisionCategory(null),this["badguy"+t].visible=!1);P=i.length,i.length=2,S==0&&(S=1,this.spawns&&this.spawns.clear(!0,!0),m=3,DatabaseCall(1,y,P-1,F),this.timedEvent2.remove(),this.scene.launch("PauseScene"),this.scene.bringToTop("PauseScene"),this.scene.pause(),this.timedEvent=this.time.delayedCall(500,()=>{}))}),this.TextTimer.x=this.cameras.main.centerX-50,this["badguy"+e].body.enable=!0,this["badguy"+e].visible=!0,this["badguy"+e].x=n[i[e]+o].x,this["badguy"+e].y=n[i[e]+o].y,this["badguy"+e]&&this["badguy"+e].visible==!0&&this["badguySensor"+e].setCollisionCategory(1)),this["badguy"+e].setRotation(n[i[e]+o].r),this.physics.moveTo(this["badguy"+e],n[i[e]+o].x,n[i[e]+o].y,400),this["badguySensor"+e].x=this["badguy"+e].x,this["badguySensor"+e].y=this["badguy"+e].y}e++}e=0,v=1,o++,this.remainingTime2=this.timedEvent2.getRemainingSeconds()}if(this.remainingTime2>0&&this.TextTimer.setText(this.remainingTime2.toFixed(2)),a%20<f){if(this.trails.getLength()>50){let s=this.trails.getFirstAlive();s&&s.destroy()}let t=this.add.rectangle(this.player.x,this.player.y,2,2,65280).setScale(1.2);for(this.tweens.add({targets:t,alpha:0,duration:200,onComplete:()=>t.destroy()}),this.physics.add.existing(t),this.trails.add(t),this.physics.add.overlap(this.badguysSensors,this.trails,()=>{n.length=i[1],w=1,this.trailTouched=0,o=0,v=0;for(let s=1;s<i.length;s++)this["badguySensor"+s]&&(this["badguy"+s].body.enable=!1,this["badguySensor"+s].visible=!1,this["badguySensor"+s].setCollisionCategory(null),this["badguy"+s].visible=!1);P=i.length,i.length=2,S==0&&(S=1,this.spawns&&this.spawns.clear(!0,!0),this.timedEvent2.remove(),m=2,DatabaseCall(1,y,P-1,F),this.scene.launch("PauseScene"),this.scene.bringToTop("PauseScene"),this.scene.pause(),this.timedEvent=this.time.delayedCall(500,()=>{}))},null,this);this["badguy"+d];){if(this["badguy"+d].body.enable==!0){if(this.evil_trails.getLength()>50){let r=this.evil_trails.getFirstAlive();r&&r.destroy()}let s=this.add.rectangle(this["badguy"+d].x,this["badguy"+d].y,2,2,16711680).setScale(1.2);this.physics.add.existing(s),s.badguy=this["badguy"+d],s.sensor=this["badguySensor"+d],this.evil_trails.add(s),this.tweens.add({targets:s,alpha:0,duration:400,onComplete:()=>s.destroy()})}d++}!this["badguy"+d]&&this.remainingTime<=0&&(d=0),this.physics.add.overlap(this.playerSensor,this.evil_trails,(s,r)=>{r.badguy&&r.badguy.body&&r.badguy.body.enable==!0&&(this.trailTouched++,r.badguy.body.enable=!1,r.sensor.setCollisionCategory(null)),this.trailTouched==i.length-1&&(i.push(n.length),this.trailTouched=0,o=0,v=0,this.timedEvent2.remove(),this.timedEvent=this.time.delayedCall(500,()=>{}),m=1,this.scene.launch("PauseScene"),this.scene.bringToTop("PauseScene"),this.scene.pause())},null,this)}}}const J={type:x.WEBGL,height:L.height,width:L.width,canvas:gameCanvas,scene:[V,j],physics:{default:"arcade",arcade:{gravity:{y:0},fps:30}}};new x.Game(J);const Z={apiKey:"AIzaSyBf8DqJ5Sr8XSIoD7lAfmtpVfKpxoJyZpc",authDomain:"timeloop-d8d45.firebaseapp.com",projectId:"timeloop-d8d45",storageBucket:"timeloop-d8d45.firebasestorage.app",messagingSenderId:"751079405156",appId:"1:751079405156:web:509b8af263d5f752ba5171"},D=_(Z),M=W(D),O=k(D);$(M).catch(p=>{console.error("Firebase Auth Error: ",p)});function B(p,a,f,g){q(M,async t=>{if(t){let X=function(){for(var b=document.getElementById("leaderboard-list"),u=!0;u;){u=!1;for(var c=b.getElementsByTagName("LI"),l=0;l<c.length-1;l++){var T=!1;if(Number(c[l].getAttribute("data-user-score"))<Number(c[l+1].getAttribute("data-user-score"))){T=!0;break}}T&&(c[l].parentNode.insertBefore(c[l+1],c[l]),u=!0)}};var s=t.uid;if(p==1)try{await H(A(O,"users"),{uid:s,name:a,score:f,puzzles:g})}catch(b){console.error("Error adding document: ",b)}const r=await R(A(O,"users")),C=document.getElementById("leaderboard-list");if(!C)return;C.innerHTML="";for(const b of r.docs){const u=b.data(),c=u.name||"Player",l=u.score||0,T=u.puzzles||"-",E=document.createElement("li");E.innerHTML=`<span>${c}</span><span>${l}</span><span>${T}</span>`,E.setAttribute("data-user-score",l),C.appendChild(E)}X()}})}window.DatabaseCall=B;B(0);
